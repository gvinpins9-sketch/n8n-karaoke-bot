{
  "name": "Karaoke Menu Bot v1.0",
  "nodes": [
    {
      "parameters": {
        "updates": ["message"],
        "additionalFields": {}
      },
      "id": "node-telegram-trigger",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [220, 300],
      "webhookId": "karaoke-menu-bot-webhook",
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-cred",
          "name": "Karaoke Bot"
        }
      },
      "notes": "–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Telegram. –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞ /menu –∏ /start."
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition-menu",
              "leftValue": "={{ $json.message.text }}",
              "rightValue": "/menu",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "condition-start",
              "leftValue": "={{ $json.message.text }}",
              "rightValue": "/start",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        }
      },
      "id": "node-filter-commands",
      "name": "Filter Commands",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [440, 300],
      "notes": "–§–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥—ã /menu –∏ /start. –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è."
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1PYWnw6IWPc7qaTjbSAy2YpWcHjfGP8wO__RvEYpAl6o",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "MENU",
          "mode": "name"
        },
        "options": {
          "range": "A:D"
        }
      },
      "id": "node-read-menu",
      "name": "Read Menu from Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [660, 200],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-cred",
          "name": "Google Sheets"
        }
      },
      "notes": "–ß–∏—Ç–∞–µ—Ç –ª–∏—Å—Ç MENU (–∫–æ–ª–æ–Ω–∫–∏ A:D) ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–∞–ø–∏—Ç–∫–æ–≤, –æ–ø–∏—Å–∞–Ω–∏—è, —Ü–µ–Ω—ã."
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1PYWnw6IWPc7qaTjbSAy2YpWcHjfGP8wO__RvEYpAl6o",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "USERS",
          "mode": "name"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "user_id",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "node-lookup-user",
      "name": "Lookup User in Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [660, 420],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-cred",
          "name": "Google Sheets"
        }
      },
      "notes": "–ò—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ user_id –≤ –ª–∏—Å—Ç–µ USERS –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –≤–∏–∑–∏—Ç–æ–≤."
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "assign-chat-id",
              "name": "chatId",
              "value": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
              "type": "number"
            },
            {
              "id": "assign-user-id",
              "name": "userId",
              "value": "={{ $('Telegram Trigger').item.json.message.from.id }}",
              "type": "number"
            },
            {
              "id": "assign-username",
              "name": "username",
              "value": "={{ $('Telegram Trigger').item.json.message.from.username || $('Telegram Trigger').item.json.message.from.first_name }}",
              "type": "string"
            },
            {
              "id": "assign-menu-text",
              "name": "menuText",
              "value": "üé§ *–ö–∞—Ä–∞–æ–∫–µ-–±–∞—Ä ‚Äî –ú–µ–Ω—é*\n\n–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:",
              "type": "string"
            },
            {
              "id": "assign-buttons",
              "name": "inlineKeyboard",
              "value": "[[{\"text\":\"üçπ –ù–∞–ø–∏—Ç–∫–∏\",\"callback_data\":\"cat_drinks\"}],[{\"text\":\"üçï –ó–∞–∫—É—Å–∫–∏\",\"callback_data\":\"cat_snacks\"}],[{\"text\":\"üç∏ –ö–æ–∫—Ç–µ–π–ª–∏\",\"callback_data\":\"cat_cocktails\"}]]",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "node-set-buttons",
      "name": "Set Menu Buttons",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [880, 200],
      "notes": "–§–æ—Ä–º–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–≤–µ—Ç–∞: chatId, —Ç–µ–∫—Å—Ç –º–µ–Ω—é –∏ InlineKeyboard —Å 3 –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ (–ù–∞–ø–∏—Ç–∫–∏/–ó–∞–∫—É—Å–∫–∏/–ö–æ–∫—Ç–µ–π–ª–∏)."
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.menuText }}",
        "additionalFields": {
          "parse_mode": "Markdown",
          "reply_markup": {
            "inline_keyboard": "={{ JSON.parse($json.inlineKeyboard) }}"
          }
        }
      },
      "id": "node-send-menu",
      "name": "Send Menu Keyboard",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1100, 200],
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-cred",
          "name": "Karaoke Bot"
        }
      },
      "notes": "–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å InlineKeyboard (3 –∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π) –≤ —á–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é."
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition-new-user",
              "leftValue": "={{ $('Lookup User in Sheets').item.json.user_id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "node-if-new-user",
      "name": "IF New User?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [880, 420],
      "notes": "–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞–π–¥–µ–Ω –ª–∏ user_id –≤ USERS. True = –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, False = —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π."
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1PYWnw6IWPc7qaTjbSAy2YpWcHjfGP8wO__RvEYpAl6o",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "USERS",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "user_id": "={{ $('Telegram Trigger').item.json.message.from.id }}",
            "username": "={{ $('Telegram Trigger').item.json.message.from.username || $('Telegram Trigger').item.json.message.from.first_name }}",
            "first_seen": "={{ $now.toISO() }}",
            "visits": 1
          }
        },
        "options": {}
      },
      "id": "node-append-new-user",
      "name": "Append New User",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [1100, 360],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-cred",
          "name": "Google Sheets"
        }
      },
      "notes": "–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ USERS: user_id, username, first_seen, visits=1."
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1PYWnw6IWPc7qaTjbSAy2YpWcHjfGP8wO__RvEYpAl6o",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "USERS",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "user_id": "={{ $('Telegram Trigger').item.json.message.from.id }}",
            "visits": "={{ Number($('Lookup User in Sheets').item.json.visits) + 1 }}"
          }
        },
        "options": {
          "cellFormat": "USER_ENTERED"
        }
      },
      "id": "node-update-user",
      "name": "Update User Visits",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [1100, 500],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-cred",
          "name": "Google Sheets"
        }
      },
      "notes": "–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç visits+1 –≤ —Å—Ç—Ä–æ–∫–µ USERS –ø–æ user_id."
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Filter Commands",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Commands": {
      "main": [
        [
          {
            "node": "Read Menu from Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "Lookup User in Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read Menu from Sheets": {
      "main": [
        [
          {
            "node": "Set Menu Buttons",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Menu Buttons": {
      "main": [
        [
          {
            "node": "Send Menu Keyboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lookup User in Sheets": {
      "main": [
        [
          {
            "node": "IF New User?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF New User?": {
      "main": [
        [
          {
            "node": "Append New User",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update User Visits",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "",
    "saveDataSuccessExecution": "all",
    "saveDataErrorExecution": "all",
    "saveExecutionProgress": true,
    "timezone": "Europe/Moscow"
  },
  "staticData": null,
  "tags": [
    {
      "name": "telegram-bot"
    },
    {
      "name": "karaoke"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2026-02-15T00:00:00.000Z",
  "versionId": "1.0.0",
  "active": true
}
